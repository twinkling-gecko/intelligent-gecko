---
marp: true
theme: moja-gecko
---

<!--- _class: cover -->

# WebAPI

## GET とか POST とか何となく知ってて<br/>WebAPI にリクエストを叩いたことがある人へ

---

# 今回の流れ

- WebAPI とは何か
- REST
- RESTful API は HTTP で
- 新しいアーキテクチャ GraphQL

---

# そもそも API とは

API(Application Programming Interface)

開発者が複雑な機能をより簡単に作成できるよう、プログラミング言語から提供される構造です。複雑なコードを抽象化し、それにかわる簡潔な構文を提供します。(MDN 参照)

---

# API の例

- 各プログラミング言語の標準 API
  - js では alert とか clipboard とか
- WebAnimetionAPI
  - 画像を動かしたり回転させるなど、Web ページの一部をアニメーションにするために利用されています。
- Twitter APIs
  - ウェブページに最新のツイートを表示するなど、ユーザーの Twitter アカウントからデータを取り出すために利用されています。
- Windows API
  - Microsoft Windows のシステムコール用 API のこと。

---

# 結局何

特定の機能を持ったプログラムの部品を提供する仕組み

平たく言うと特定機能を持った出来合いの関数

多くはカプセル化することで内部挙動を知らずに扱えるようにしたもの

---

# じゃあ WebAPI

API の Web 版

- ネットワーク越しの API
- 使用者は URI をエンドポイントとしてリクエストを実行してもらう

(例) :
GET => https://tatikaze.com/api/task => { “name”: “スプラで S+になる” }

---

# クライアント／サーバ

Web の基本的なアーキテクチャ
それぞれ切り離しができる

![](https://user-images.githubusercontent.com/43057959/87008089-2f70d880-c1fe-11ea-8767-265293e9f439.png)

ここから Web の主要アーキテクチャ REST ができた

---

# REST ってなんだ？

<br/>

英語（Representational State Transfer）

![](https://user-images.githubusercontent.com/43057959/87008374-9a221400-c1fe-11ea-940a-7f9297b4f49c.png)

命名者の意図は**リソースの状態を表現**するということらしい
by WEB を支える技術

---

# リソース指向

リソースとはウェブ上に存在する、名前を持ったありとあらゆる情報

[http://tatikaze.com/api/task](http://tatikaze.com/api/task)
という URI だと tatikaze.com にある/api/task というリソースのことを示している

URI でリソースを一位に指定するという考え方

---

# 複合アーキテクチャ

- ステートレスサーバ
  - サーバはクライアントのステートを管理しない
- キャッシュ
  - サーバから取ってきたデータをクライアント側でしばらく使い回す
- 統一インタフェース
  - リソースに対する操作を統一した限定的なインタフェース
- コードオンデマンド
  - プログラムを毎回サーバからダウンロードして実行する

---

# HTTP

REST の原則に則った実装に向いているプロトコルは HTTP

- Hyper Text Transfer Protcol
- 最初はハイパーテキスト転送用プロトコルだったが今ではコンピュータで扱えるデータなら何でも転送できる
- リクエスト／レスポンス形式のプロトコル
- REST 視点
  - **ステートレスサーバ**
  - **統一インタフェース**
  - キャッシュ

---

# HTTP メッセージ

- スタートライン
  - リクエスト
    - メソッド、URI、プロトコルバージョン
  - レスポンス
    - プロトコルバージョン、ステータスコード、テキストフレーズ
- ヘッダ
  - メッセージのメタデータ
- ボディ
  - コンテンツそのもの

---

# HTTP のステートレス性１

サーバはクライアントのステートを管理しない
ステートレスなやり取りの場合、全てのクライアント側の状態をまとめてサーバに伝えるため、サーバはクライアント側の状態を意識する必要性がなくなる

---

# HTTP のステートレス性２

状況：治郎は強めの敵と交戦したのでダラスに加勢してほしい

| ステートフルの場合       | ステートレスの場合                             |
| ------------------------ | ---------------------------------------------- |
| 治郎: 　手を貸せ！！！！ | 治郎:　手を貸せ！                              |
| ダラス: どうしてだ？     | ダラス: どうしてだ？                           |
| 治郎: 　ドーザーや！     | 治郎: 　ドーザーがおるから手をかせ！！         |
| ダラス: どこにいるんだ？ | ダラス: どこにいるんだ？                       |
| 治郎: 　階段下や！       | 治郎: 　ドーザーが階段下におるから手を貸せ！！ |
| ダラス: 今行く           | ダラス: 今行く                                 |

---

# ステートレスの利点

多数のリクエストが同時に飛び交うようなシステムの中でそれぞれのクライアントの状態を管理しているといずれ管理しきれなくなる

- それまでの通信とは関係なく処理中のリクエストのみに専念することができる
- サーバは比較的単純なシステムになる

---

# ステートレスの欠点

- パフォーマンスの低下
  - 毎回必要な情報全てを送信する必要がある
  - 認証などを毎回する
- 通信エラー時
  - 同リクエストを２回送った場合、サーバ側はクライアントの状態を管理していないためどちらもリクエストが通ってしまったりする

---

# HTTP メソッド

メソッドは全部で９種類

- GET
  - GET メソッドは、指定したリソースの表現をリクエストします。 GET を使用するリクエストは、データの取り込みに限ります。
- POST
  - POST は指定したリソースに実体を送信するために使用するメソッドであり、サーバー上の状態を変更したり、副作用が発生したりすることがよくあります。
- PUT
  - PUT メソッドは対象リソースの現在の表現の全体を、リクエストのペイロードで置き換えます。

---

# HTTP メソッド

- DELETE
  - DELETE メソッドは、指定したリソースを削除します。
- PATCH
  - PATCH メソッドは、リソースを部分的に変更するために使用します。

by MDN web doc

<br/>

ほか HEAD, CONNECT, OPTIONS, TRACE を含めた９つのメソッド
**やろうと思えば GET でリソース削除とかできる（ダメ絶対）**

---

# 最近出てきた新しいやつ

GraphQL

- WebAPI の問い合わせ言語
- データの型（schema）を定義できる
- 特定のデータベースやストアに依存しない
- データの取得（Query）
- データの作成・更新・削除（Mutation）

---

# GraphQL の特徴

- API を集約
  - 複数のリソースをまとめて取得することができる
- スキーマファースト開発
  - サーバ・クライアントの接続部分となるスキーマを始めに決めることで齟齬がなく手戻りすることを少なくする手法
- マイクロサービス提供に向いている
  - 複数のデータソースをまとめることに適している

![w:500](https://user-images.githubusercontent.com/43057959/87011115-7365dc80-c202-11ea-9d26-be3b6683febd.png)
