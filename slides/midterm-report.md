---
marp: true
theme: moja-gecko
---

<!-- _class: cover -->

# 日常生活におけるアナログデータ可視化による QoL の向上

## 卒業制作 中間発表<br>Team twinkling-gecko<br>2020-12-07

<!-- (原稿)
それでは私達の発表を始めさせていただきます。
私達、チームtwinkling-geckoでは、
日常生活におけるアナログデータ可視化によるQoLの向上
をテーマとして卒業制作を進めて参りました。
-->

---

# メンバー

- リーダー 上村健太 (システム専攻)
- メンバー 鈴木颯太 (システム専攻)
- メンバー 篠原彰 (システム専攻)
- メンバー 小林稜太 (ネットワーク専攻)

<br>

- 属人化を避ける為、担当分野の固定はしていない

<!-- (原稿)
メンバーは上村、鈴木、篠原、小林の4名で、今回は作業の属人化を避ける為に誰が何処を担当すると言ったような担当分野の固定はしておらず、全員が分野を問わずに作業を担当することを目標として進めて参りました。

順に自己紹介をさせていただきます。
-->

<!-- (メモ)
スクラム開発における"属人性の排除"の解釈については諸説ある
ここでは、うちの学校の卒制でありがちな"完全な役割分担で他の分野を触ることが出来ない"を避ける という意味合い
http://bonotake.hatenablog.com/entry/2018/01/12/085058
-->

---

# プレゼンの流れ

## 1. テーマ概要

## 2. デモンストレーション

## 3. 開発環境について

## 4. 進捗とスケジュールについて

<!-- (原稿)
今回の発表では、最初にテーマの概要を説明し、デモンストレーションをお見せします。
その後、開発周りの話、開発のスケジュールについての話 という流れで進めていこうと思います。
-->

---

# テーマ概要 (1/3)

## 日常生活におけるメタデータを集積・可視化するプラットフォーム

![image](https://user-images.githubusercontent.com/38117745/101239515-57238880-372b-11eb-8ae4-15e65dab1b32.png)

<!-- (原稿)
私達はチームテーマとして
"日常生活におけるアナログデータ可視化による QoL の向上"
を掲げましたが、これを体現する為に、
日常生活におけるメタデータを集積・可視化するプラットフォーム
というものを作成しています。

これは日常生活の中にあるメタデータ、
例えば食べ物や飲み物の消費期限・カロリー
洗剤や消耗品の残量・在庫や消耗時刻といった情報を収集し、そこから
消費量の統計や依存性チェック、消費優先度の算出や追加購入の通知、需要予測の最適化などの付加価値を提供する為のプラットフォームとなっています。
-->

---

# テーマ概要 (2/3)

## システム概要

![image](https://user-images.githubusercontent.com/38117745/101282076-3126e280-3816-11eb-8933-1027ee4a0c20.png)

<!-- (原稿)
具体的な内容に移ります。
私達のプラットフォームは主に3つの要素から構成され、
実際にメタデータを取得する部分であり、センサーとマイコンを組み合わせたモノ、これを私達はセンシングユニットと呼んでいます。 これは各家庭や店舗に複数設置されることを想定しています。

そのセンシングユニットからのデータを集約し、クラウドに構築されたプラットフォームへのデータ送信やセンシングユニットの管理を担当するローカルハブ

そして、各家庭や店舗のローカルハブからデータを受け取り、それらを集積するプラットフォームという構造になっています。

私達はプラットフォーム部分の構築を担当し、メタデータの利活用を行いたい企業が規格に沿ったセンシングユニットを作成、ゆくゆくは各家庭に複数のセンサーを配置し、消費者・企業の双方がこれまで活用していなかったデータを活用出来ることを目標としています。

今回はロールモデルとして、重量センサーで消耗品の重量を計測し、消費量を元に統計を表示したり、依存性チェックを行うものを用意しました。

他に考えられるものとして、開閉センサーを利用したドア開閉による移動量のチェックや照度センサーによる睡眠のチェックを始め、センシングユニットを開発することで、様々なメタデータを利活用することが可能です。
-->

<!-- TODO プラットフォームという言葉について プロジェクトの全体を示す語と、クラウドに置くものを示す語がかぶっているので何か考える -->

---

# テーマ概要 (3/3)

## 構成要素

![image](https://user-images.githubusercontent.com/38117745/101282110-68958f00-3816-11eb-8367-70b3b64cef99.png)

<!-- (原稿)
続いて技術的な内容です。
先程の図の3つの要素を具体的な技術要素に置き換えた図にしました。

センシングユニットにはマイコンとしてM5Stackを、重量センサーとしてロードセルとADコンバータを利用しています。

ローカルハブにはRaspberry Pi 4の4GBモデルを使うこととしました。

プラットフォーム部分では、コスト面からGCPを利用することとし、CIとしてCloud Buildを利用。
フロントエンド/WebAPI共にNuxt.jsを利用し、Dockerに固めてデプロイする構成を取っています。
-->

---

# デモンストレーション

## 動画によるデモンストレーションをお見せします。

<!-- (原稿)
現段階では試作状態で、ケーブルや基板がむき出しになっていますが、こちらが重量センサータイプのセンシングユニットで、ここに計測対象物を載せて使うことになります。

ここからコーヒーや酒、洗剤を取って、使って戻しました。

すると、センシングユニットから飲んだ分だけ減った重量データがローカルハブに送信されます。

Webアプリからコーヒーの消費量を確認することが出来ます。
-->

<!-- (メモ)
この動画の中で、
- はかりで重量を測ってるシーン
- BLEのブロードキャストの傍受
- プラットフォームへ登録されてるところ
を撮影してそれっぽくつなぎ合わせるといいかも

流れはDiscordに書いた内容を使う予定
動画を止めつつ話す感じで良いかも?
-->

---

# 開発環境について

## 課題

- 開発に使うマシンや環境の差
- コード品質の維持
- Vim で開発したい
- デプロイの手間

<!-- (原稿)
ここからは開発に関しての話になります。

実際に開発をする上で、いくつか問題点がありました。
まず1つ目が、メンバー間で開発に使うマシンや環境の差が大きいこと。
2つ目がコード品質の維持について。
3つ目がVimを使いたいという希望があった点。
4つ目がデプロイに手間がかかるという点。

それぞれについて見ていきます。
-->

---

# 開発環境について (1/4)

## 環境の差

- 貸与品 dynabook & Windows + WSL2 + Ubuntu
- 貸与品 dynabook & Ubuntu
- ThinkPad & Ubuntu
- MacBook Air & MacOS

<br>

**→Docker に閉じ込めて docker-compose で管理**

<!-- (原稿)
開発環境についての話ですが、チーム内で環境が割とバラバラになっています。今回は開発環境をDocker+docker-composeで構築し、環境に起因するトラブルを回避するようにしました。
また、環境をコンテナに閉じ込めることでCI/CD環境へ展開する事も容易になります。
-->

---

# 開発環境について (2/4)

## コード品質の維持

- coc.nvim の CocAction
- pre-commit

<br>

- DX/PX 向上デーの実施

<!-- (原稿)
複数人で開発する際に問題となるのがコード品質の維持。コードスタイル等の差異は1アクションでLanguage Serverのフォーマット機能を呼び出せるCocActionやpre-commitによる検査により補正することにしました。

また、定期的にDX/PX向上デーとして開発環境に関する知見の共有を行い、lintやフォーマッタを確認出来るようにしました。
-->

---

# 開発環境について (3/4)

## Vim で開発したい

- コマンドラインでコンパイル&アップロード
- Language Server の支援を受けたい
  - include path の問題が発生

<br>

![image](https://user-images.githubusercontent.com/38117745/101244745-7a5e3000-374b-11eb-8d26-4bb97881b424.png)

<!-- (原稿)
マイコンの開発をするに当たり、Arduinoプラットフォームを利用する前提で、3つの環境を試しました。

1. Arduino IDE
2. Arduino CLI
3. PlatformIO

最終的に私達のチームではPlatformIOをDockerに閉じ込めた環境を構築して使うこととしました。

Arduino IDEは最も手軽な環境ですが、IDEとしての使い勝手が悪いので、物品の検品を兼ねた最初期のテストにのみ使用しました。

任意のエディタを使うことを前提に、CLIツールによるコンパイル&アップロードとライブラリの管理のソリューションを模索する中で、
Arduino CLIはArduino公式でサポートされているコマンドラインツールで、当初はこれをベースにDockerに閉じ込めて、ライブラリの格納先をホストと共有することで環境を作ろうとしました。
しかし、C++のLanguage Serverがこのライブラリをincludeできなかった為、arduino-cliを使う方法は断念。

PlatformIOをベースにすることとし、ライブラリ郡はPlatformIOの持つライブラリ管理システムに乗っかり、出力されるLanguage Server用のinclude pathを記述したファイルのパスを置換することで対応。

ホストの環境を汚さず、VimでC++のLanguage Serverであるcclsの支援を受けながらコーディングし、ターミナルからビルドとアップロードする環境を用意しました。
-->

---

# 開発環境について (4/4)

## デプロイの手間 (CI/CD について)

- GitHub Actions で lint をかける (CI)
- Cloud Build から GAE への自動デプロイ (CD)

![image](https://user-images.githubusercontent.com/38117745/101280728-12bce900-380e-11eb-990e-56144a96c0a9.png)

<!-- (原稿)
続いてデプロイの手間という面で、ここではGitHub Actionsにworkflowを定義し、pushされたら自動でlintが走るように。
CIが通ってdevelopブランチにプッシュがあれば、Cloud Buildにより自動的にデプロイする環境を整えました。

機能ごとにブランチを切って実装を行い、実装が終わる度にレビューを通してdevelopブランチへマージしてGAEへデプロイして待つ という流れが割と手間になっていた為、この部分の手間の軽減は効果があったと考えています。
-->

---

# 進捗とスケジュールについて

## 物品の調達遅れ

- 学校側の物品管理の問題により、物品の受け取りが 10 月の下旬までずれ込んだ
  - そこから実機を用いての検証を開始し、実現可能である事を確認した段階

## 今後の予定

- スケジュール遅延により、当初予定していた部分の多くは諦めざるを得ない
  - 最低限必要な機能をピックアップして実装を進める

<!-- (原稿)
最後に今後の進捗とスケジュールについてです。
まず、問題として物品の調達遅れがあり、スケジュールが大幅に後ろ倒しになっています。
当初のスケジュールで8月中を予定していた、実物を使っての検証やプロトタイピングが10月の最終週からのスタートとなり、進捗も遅れています。

今後の予定ですが、恐らく当初に予定していた部分の多くを諦めざるを得ない状況となっています。
アラートの通知機能など、必要な機能をピックアップして実装を進めていきます。
-->

---

<!-- _class: back-cover -->

# ご清聴ありがとうございました

<!--
質疑応答用メモ
- Amazonの自動発注秤
- ATOM Sensor
 -->
